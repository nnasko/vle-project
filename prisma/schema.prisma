// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
}

enum AttendanceStatus {
  PRESENT
  LATE
  ABSENT
  AUTHORIZED
}

enum GradeLevel {
  FIRST_YEAR
  SECOND_YEAR
  THIRD_YEAR
  FOURTH_YEAR
}

enum CourseDuration {
  FULL_TIME
  PART_TIME
}

model User {
  id                String         @id @default(cuid())
  email             String         @unique
  name              String
  password          String?         // Hashed password
  role              UserRole
  avatar            String?
  phone             String?
  joinDate          DateTime       @default(now())
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  isActive          Boolean        @default(true)
  
  // Role-specific relations
  studentProfile    Student?
  teacherProfile    Teacher?
  adminProfile      Admin?
  
  // Common relations
  notifications     Notification[]
  messages         Message[]       @relation("MessageSender")
  receivedMessages Message[]       @relation("MessageReceiver")
}

model Student {
  id                String         @id @default(cuid())
  user              User           @relation(fields: [userId], references: [id])
  userId            String         @unique
  studentId         String         @unique
  cohort            Cohort?        @relation(fields: [cohortId], references: [id])
  cohortId          String?
  expectedGraduation DateTime
  currentGrade      GradeLevel
  overallGrade      Float?
  attendance        Attendance[]
  assignments       Assignment[]
  grades           Grade[]
}

model Teacher {
  id               String         @id @default(cuid())
  user             User           @relation(fields: [userId], references: [id])
  userId           String         @unique
  employeeId       String         @unique
  department       Department     @relation(fields: [departmentId], references: [id])
  departmentId     String
  position         String
  specializations  String[]
  cohorts          Cohort[]
  lessons          Lesson[]
}

model Admin {
  id               String         @id @default(cuid())
  user             User           @relation(fields: [userId], references: [id])
  userId           String         @unique
  employeeId       String         @unique
  department       Department     @relation(fields: [departmentId], references: [id])
  departmentId     String
  role             String
  responsibilities String[]
}

model Department {
  id               String         @id @default(cuid())
  name             String         @unique
  description      String?
  headOfDepartment String
  teachers         Teacher[]
  admins           Admin[]
  courses          Course[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  isActive         Boolean        @default(true)
}

model Course {
  id               String         @id @default(cuid())
  name             String
  code             String         @unique
  description      String?
  department       Department     @relation(fields: [departmentId], references: [id])
  departmentId     String
  duration         CourseDuration
  cohorts          Cohort[]
  modules          Module[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  isActive         Boolean        @default(true)
}

model Module {
  id               String         @id @default(cuid())
  name             String
  code             String
  description      String?
  course           Course         @relation(fields: [courseId], references: [id])
  courseId         String
  lessons          Lesson[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Cohort {
  id               String         @id @default(cuid())
  name             String
  course           Course         @relation(fields: [courseId], references: [id])
  courseId         String
  teacher          Teacher        @relation(fields: [teacherId], references: [id])
  teacherId        String
  startDate        DateTime
  endDate          DateTime
  students         Student[]
  lessons          Lesson[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  isActive         Boolean        @default(true)
}

model Lesson {
  id               String         @id @default(cuid())
  topic            String
  description      String?
  module           Module         @relation(fields: [moduleId], references: [id])
  moduleId         String
  cohort           Cohort         @relation(fields: [cohortId], references: [id])
  cohortId         String
  teacher          Teacher        @relation(fields: [teacherId], references: [id])
  teacherId        String
  date             DateTime
  startTime        DateTime
  endTime          DateTime
  room             String
  materials        String[]
  attendance       Attendance[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Attendance {
  id               String           @id @default(cuid())
  lesson           Lesson           @relation(fields: [lessonId], references: [id])
  lessonId         String
  student          Student          @relation(fields: [studentId], references: [id])
  studentId        String
  status           AttendanceStatus
  minutesLate      Int?
  notes            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@unique([lessonId, studentId])
}

model Assignment {
  id               String         @id @default(cuid())
  title            String
  description      String
  dueDate          DateTime
  student          Student        @relation(fields: [studentId], references: [id])
  studentId        String
  submissionDate   DateTime?
  grade            Float?
  feedback         String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Grade {
  id               String         @id @default(cuid())
  student          Student        @relation(fields: [studentId], references: [id])
  studentId        String
  title            String
  score            Float
  maxScore         Float
  weight           Float
  feedback         String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Notification {
  id               String         @id @default(cuid())
  user             User           @relation(fields: [userId], references: [id])
  userId           String
  title            String
  message          String
  type             String        // academic, message, assignment, grade, alert
  read             Boolean        @default(false)
  link             String?
  createdAt        DateTime       @default(now())
}

model Message {
  id               String         @id @default(cuid())
  sender           User           @relation("MessageSender", fields: [senderId], references: [id])
  senderId         String
  receiver         User           @relation("MessageReceiver", fields: [receiverId], references: [id])
  receiverId       String
  subject          String
  content          String
  read             Boolean        @default(false)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}